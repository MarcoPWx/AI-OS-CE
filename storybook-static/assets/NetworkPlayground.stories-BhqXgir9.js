import{r as s,R as e}from"./index-R2V08a_e.js";import{D}from"./DefaultsChip-CQdNt6TR.js";const G=[{method:"GET",path:"/api/lessons"},{method:"GET",path:"/api/quizzes"},{method:"GET",path:"/api/cache"},{method:"GET",path:"/api/ratelimit"},{method:"POST",path:"/api/login"}];function O({row:l}){const r=l.status>=500?"#ff6b6b":l.status>=400?"#ffcc00":"#00d084";return e.createElement("tr",null,e.createElement("td",null,new Date(l.ts).toLocaleTimeString()),e.createElement("td",null,l.method),e.createElement("td",null,l.path),e.createElement("td",null,l.status),e.createElement("td",null,l.ms," ms"),e.createElement("td",{style:{color:r}},l.error||""))}function N(){const[l,r]=s.useState(0),[E,c]=s.useState(0),[T,f]=s.useState([]),[g,_]=s.useState(!1),[o,m]=s.useState(null),[u,d]=s.useState(!1),S=t=>f(a=>[t,...a].slice(0,200)),k=async()=>{await fetch("/__msw__/defaults",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latencyMs:l,errorRate:E})});const t=await fetch("/__msw__/defaults").then(a=>a.json()).catch(()=>null);t&&(r(t.latencyMs??l),c(t.errorRate??E),m({latencyMs:t.latencyMs??0,errorRate:t.errorRate??0}))},v=async()=>{r(0),c(0),await fetch("/__msw__/defaults",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latencyMs:0,errorRate:0})}),m({latencyMs:0,errorRate:0})},n=async(t,a)=>{const y=Date.now();try{const i=t==="POST"?{method:"POST",headers:{"Content-Type":"application/json",...g?{"x-msw-no-defaults":"1"}:{}},body:JSON.stringify({email:"demo@quizmentor.app"})}:{method:"GET",headers:g?{"x-msw-no-defaults":"1"}:void 0},w=await fetch(a,i),P=Date.now()-y;S({ts:y,method:t,path:a,status:w.status,ms:P})}catch(i){const w=Date.now()-y;S({ts:y,method:t,path:a,status:-1,ms:w,error:(i==null?void 0:i.message)||"network error"})}},x=async()=>{d(!0),f([]),await n("GET","/api/lessons"),await n("GET","/api/quizzes"),await n("GET","/api/cache"),await n("GET","/api/cache");for(let t=0;t<4;t++)await n("GET","/api/ratelimit");await n("POST","/api/login"),d(!1)},M=async()=>{d(!0),f([]);const t=[n("GET","/api/lessons"),n("GET","/api/quizzes"),n("GET","/api/cache"),n("GET","/api/ratelimit"),n("POST","/api/login")];await Promise.all(t),await Promise.all([n("GET","/api/cache"),n("GET","/api/ratelimit")]),d(!1)},p=async t=>{const a=t==="slower"?{latencyMs:300,errorRate:0}:t==="flaky"?{latencyMs:100,errorRate:.2}:t==="chaos"?{latencyMs:500,errorRate:.5}:{latencyMs:0,errorRate:0};await fetch("/__msw__/defaults",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),r(a.latencyMs),c(a.errorRate),m(a)};return s.useEffect(()=>{(async()=>{const t=await fetch("/__msw__/defaults").then(a=>a.json()).catch(()=>null);t&&(r(t.latencyMs??0),c(t.errorRate??0),m({latencyMs:t.latencyMs??0,errorRate:t.errorRate??0}))})()},[]),e.createElement("div",{style:{padding:16}},e.createElement("h3",null,"Network Playground (MSW Defaults + Timeline)"),e.createElement("div",{style:{marginBottom:8}},e.createElement(D,null)),e.createElement("p",null,"Set global latency/error defaults that MSW handlers read, then run a scenario across multiple endpoints and inspect the request timeline."),e.createElement("div",{style:{display:"flex",gap:16,alignItems:"center",flexWrap:"wrap",marginBottom:12}},e.createElement("div",null,e.createElement("div",{style:{fontWeight:600}},"Current Defaults"),e.createElement("div",{style:{fontSize:12,opacity:.8}},"latencyMs=",(o==null?void 0:o.latencyMs)??0,", errorRate=",(o==null?void 0:o.errorRate)??0)),e.createElement("div",null,e.createElement("div",{style:{fontWeight:600}},"Presets"),e.createElement("div",{style:{display:"flex",gap:8}},e.createElement("button",{onClick:()=>p("default")},"Default"),e.createElement("button",{onClick:()=>p("slower")},"Slower"),e.createElement("button",{onClick:()=>p("flaky")},"Flaky"),e.createElement("button",{onClick:()=>p("chaos")},"Chaos"))),e.createElement("label",null,"Latency (ms):",e.createElement("input",{type:"number",min:0,max:1e4,value:l,onChange:t=>r(Number(t.target.value)||0),style:{width:100,marginLeft:8}})),e.createElement("label",null,"Error Rate (0.0–1.0):",e.createElement("input",{type:"number",step:"0.05",min:0,max:1,value:E,onChange:t=>c(Number(t.target.value)||0),style:{width:100,marginLeft:8}})),e.createElement("button",{onClick:k},"Apply"),e.createElement("button",{onClick:v},"Reset"),e.createElement("label",null,e.createElement("input",{type:"checkbox",checked:g,onChange:t=>_(t.target.checked)})," ","Send x-msw-no-defaults on requests"),e.createElement("button",{onClick:x,disabled:u},u?"Running…":"Run Scenario"),e.createElement("button",{onClick:M,disabled:u},u?"Running…":"Run Concurrent")),e.createElement("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:8}},G.map(t=>e.createElement("button",{key:t.method+t.path,onClick:()=>n(t.method,t.path)},t.method," ",t.path))),e.createElement("div",{style:{marginTop:12}},e.createElement("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12}},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",{style:{textAlign:"left"}},"Time"),e.createElement("th",{style:{textAlign:"left"}},"Method"),e.createElement("th",{style:{textAlign:"left"}},"Path"),e.createElement("th",{style:{textAlign:"left"}},"Status"),e.createElement("th",{style:{textAlign:"left"}},"Duration"),e.createElement("th",{style:{textAlign:"left"}},"Notes"))),e.createElement("tbody",null,T.map((t,a)=>e.createElement(O,{key:a,row:t})),T.length===0&&e.createElement("tr",null,e.createElement("td",{colSpan:6},"No requests yet…"))))))}const A={title:"Dev/NetworkPlayground",component:N,parameters:{helpDoc:"?path=/story/specs-service-catalog--page#flows",helpTitle:"Service Catalog — Flows",docs:{description:{component:"Set MSW latency/error defaults for all handlers, then exercise endpoints and review a live timeline with status and duration."}}}},h={};var b,R,C;h.parameters={...h.parameters,docs:{...(b=h.parameters)==null?void 0:b.docs,source:{originalSource:"{}",...(C=(R=h.parameters)==null?void 0:R.docs)==null?void 0:C.source}}};const W=["Default"];export{h as Default,W as __namedExportsOrder,A as default};
