var D=Object.defineProperty;var Q=(s,n,e)=>n in s?D(s,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[n]=e;var l=(s,n,e)=>Q(s,typeof n!="symbol"?n+"":n,e);import{r as L,R as h}from"./index-R2V08a_e.js";import{D as W}from"./DefaultsChip-CQdNt6TR.js";var S={exports:{}},y=typeof Reflect=="object"?Reflect:null,E=y&&typeof y.apply=="function"?y.apply:function(n,e,t){return Function.prototype.apply.call(n,e,t)},v;y&&typeof y.ownKeys=="function"?v=y.ownKeys:Object.getOwnPropertySymbols?v=function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:v=function(n){return Object.getOwnPropertyNames(n)};function B(s){console&&console.warn&&console.warn(s)}var O=Number.isNaN||function(n){return n!==n};function a(){a.init.call(this)}S.exports=a;S.exports.once=q;a.EventEmitter=a;a.prototype._events=void 0;a.prototype._eventsCount=0;a.prototype._maxListeners=void 0;var M=10;function g(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return M},set:function(s){if(typeof s!="number"||s<0||O(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");M=s}});a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};a.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||O(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this};function T(s){return s._maxListeners===void 0?a.defaultMaxListeners:s._maxListeners}a.prototype.getMaxListeners=function(){return T(this)};a.prototype.emit=function(n){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);var r=n==="error",o=this._events;if(o!==void 0)r=r&&o.error===void 0;else if(!r)return!1;if(r){var i;if(e.length>0&&(i=e[0]),i instanceof Error)throw i;var u=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw u.context=i,u}var c=o[n];if(c===void 0)return!1;if(typeof c=="function")E(c,this,e);else for(var f=c.length,p=R(c,f),t=0;t<f;++t)E(p[t],this,e);return!0};function N(s,n,e,t){var r,o,i;if(g(e),o=s._events,o===void 0?(o=s._events=Object.create(null),s._eventsCount=0):(o.newListener!==void 0&&(s.emit("newListener",n,e.listener?e.listener:e),o=s._events),i=o[n]),i===void 0)i=o[n]=e,++s._eventsCount;else if(typeof i=="function"?i=o[n]=t?[e,i]:[i,e]:t?i.unshift(e):i.push(e),r=T(s),r>0&&i.length>r&&!i.warned){i.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=s,u.type=n,u.count=i.length,B(u)}return s}a.prototype.addListener=function(n,e){return N(this,n,e,!1)};a.prototype.on=a.prototype.addListener;a.prototype.prependListener=function(n,e){return N(this,n,e,!0)};function G(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function C(s,n,e){var t={fired:!1,wrapFn:void 0,target:s,type:n,listener:e},r=G.bind(t);return r.listener=e,t.wrapFn=r,r}a.prototype.once=function(n,e){return g(e),this.on(n,C(this,n,e)),this};a.prototype.prependOnceListener=function(n,e){return g(e),this.prependListener(n,C(this,n,e)),this};a.prototype.removeListener=function(n,e){var t,r,o,i,u;if(g(e),r=this._events,r===void 0)return this;if(t=r[n],t===void 0)return this;if(t===e||t.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete r[n],r.removeListener&&this.emit("removeListener",n,t.listener||e));else if(typeof t!="function"){for(o=-1,i=t.length-1;i>=0;i--)if(t[i]===e||t[i].listener===e){u=t[i].listener,o=i;break}if(o<0)return this;o===0?t.shift():j(t,o),t.length===1&&(r[n]=t[0]),r.removeListener!==void 0&&this.emit("removeListener",n,u||e)}return this};a.prototype.off=a.prototype.removeListener;a.prototype.removeAllListeners=function(n){var e,t,r;if(t=this._events,t===void 0)return this;if(t.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t[n]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete t[n]),this;if(arguments.length===0){var o=Object.keys(t),i;for(r=0;r<o.length;++r)i=o[r],i!=="removeListener"&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=t[n],typeof e=="function")this.removeListener(n,e);else if(e!==void 0)for(r=e.length-1;r>=0;r--)this.removeListener(n,e[r]);return this};function k(s,n,e){var t=s._events;if(t===void 0)return[];var r=t[n];return r===void 0?[]:typeof r=="function"?e?[r.listener||r]:[r]:e?K(r):R(r,r.length)}a.prototype.listeners=function(n){return k(this,n,!0)};a.prototype.rawListeners=function(n){return k(this,n,!1)};a.listenerCount=function(s,n){return typeof s.listenerCount=="function"?s.listenerCount(n):x.call(s,n)};a.prototype.listenerCount=x;function x(s){var n=this._events;if(n!==void 0){var e=n[s];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?v(this._events):[]};function R(s,n){for(var e=new Array(n),t=0;t<n;++t)e[t]=s[t];return e}function j(s,n){for(;n+1<s.length;n++)s[n]=s[n+1];s.pop()}function K(s){for(var n=new Array(s.length),e=0;e<n.length;++e)n[e]=s[e].listener||s[e];return n}function q(s,n){return new Promise(function(e,t){function r(i){s.removeListener(n,o),t(i)}function o(){typeof s.removeListener=="function"&&s.removeListener("error",r),e([].slice.call(arguments))}P(s,n,o,{once:!0}),n!=="error"&&H(s,r,{once:!0})})}function H(s,n,e){typeof s.on=="function"&&P(s,"error",n,e)}function P(s,n,e,t){if(typeof s.on=="function")t.once?s.once(n,e):s.on(n,e);else if(typeof s.addEventListener=="function")s.addEventListener(n,function r(o){t.once&&s.removeEventListener(n,r),e(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}var U=S.exports,A={};const d=class d extends U.EventEmitter{constructor(e,t){super();l(this,"url");l(this,"readyState");l(this,"protocol");l(this,"extensions");l(this,"binaryType");l(this,"simulationTimer",null);l(this,"taskTimer",null);l(this,"lobbies",new Map);l(this,"currentLobbyId",null);l(this,"playerId");l(this,"isHost",!1);l(this,"scenario","lobbyBasic");l(this,"didSimulateDisconnect",!1);l(this,"onopen",null);l(this,"onclose",null);l(this,"onerror",null);l(this,"onmessage",null);this.url=e,this.readyState=d.CONNECTING,this.protocol="",this.extensions="",this.binaryType="blob",this.playerId=`player_${Math.random().toString(36).substr(2,9)}`;const r=typeof window<"u"&&window.__WS_MOCK_SCENARIO__?window.__WS_MOCK_SCENARIO__:void 0;this.scenario=r||A.WS_MOCK_SCENARIO||this.scenario,setTimeout(()=>{this.readyState=d.OPEN,this.dispatchEvent(new Event("open")),this.startSimulation(),this.scenario==="disconnectRecovery"&&!this.didSimulateDisconnect&&this.simulateTemporaryDisconnect()},Math.random()*500+100)}send(e){if(this.readyState!==d.OPEN)throw new Error("WebSocket is not open");let t;try{t=typeof e=="string"?JSON.parse(e):e}catch{t=e}console.log("[MockWebSocket] Sending:",t),this.handleOutgoingMessage(t)}close(e,t){this.readyState===d.CLOSING||this.readyState===d.CLOSED||(this.readyState=d.CLOSING,setTimeout(()=>{this.readyState=d.CLOSED,this.stopSimulation(),this.dispatchEvent(new CloseEvent("close",{code:e,reason:t}))},100))}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}dispatchEvent(e){return this.emit(e.type,e),!0}handleOutgoingMessage(e){const{type:t,payload:r}=e;switch(t){case"CREATE_LOBBY":this.handleCreateLobby(r);break;case"JOIN_LOBBY":this.handleJoinLobby(r);break;case"LEAVE_LOBBY":this.handleLeaveLobby();break;case"START_GAME":this.handleStartGame();break;case"SUBMIT_ANSWER":this.handleSubmitAnswer(r);break;case"SEND_MESSAGE":this.handleSendMessage(r);break;case"PLAYER_READY":this.handlePlayerReady();break;case"PING":this.sendMessage({type:"PONG",timestamp:Date.now()});break}}handleCreateLobby(e){const t=`lobby_${Date.now()}`,r=Math.random().toString(36).substr(2,6).toUpperCase(),o={id:t,code:r,name:e.name||"New Quiz Room",host:this.playerId,players:[{id:this.playerId,name:e.playerName||"Host",avatar:e.avatar,score:0,ready:!0,connected:!0}],maxPlayers:e.maxPlayers||4,gameStarted:!1,currentQuestion:0,totalQuestions:e.questionCount||10};this.lobbies.set(t,o),this.currentLobbyId=t,this.isHost=!0,this.sendMessage({type:"lobby:created",payload:{lobbyId:t,code:r,lobby:o}})}handleJoinLobby(e){const{code:t,playerName:r,avatar:o}=e;let i;for(const[c,f]of this.lobbies)if(f.code===t){i=f,this.currentLobbyId=c;break}if(!i){const c=`lobby_${t}`;i={id:c,code:t,name:"Quiz Room",host:"host_123",players:[{id:"host_123",name:"Quiz Master",score:0,ready:!0,connected:!0}],maxPlayers:4,gameStarted:!1,currentQuestion:0,totalQuestions:10},this.lobbies.set(c,i),this.currentLobbyId=c}const u={id:this.playerId,name:r||"Player",avatar:o,score:0,ready:!1,connected:!0};i.players.push(u),this.sendMessage({type:"lobby:joined",payload:{lobby:i,playerId:this.playerId}}),setTimeout(()=>{this.sendMessage({type:"player:joined",payload:{player:u}})},500),this.scenario==="matchHappyPath"&&setTimeout(()=>{i.players.forEach(c=>c.ready=!0),this.sendMessage({type:"lobby:updated",payload:{lobby:i,allReady:!0}}),this.isHost=!0,this.handleStartGame()},800)}handleLeaveLobby(){if(!this.currentLobbyId)return;const e=this.lobbies.get(this.currentLobbyId);e&&(e.players=e.players.filter(t=>t.id!==this.playerId),this.sendMessage({type:"lobby:left",payload:{playerId:this.playerId}}),this.sendMessage({type:"player:left",payload:{playerId:this.playerId}}),this.currentLobbyId=null)}handleStartGame(){if(!this.currentLobbyId||!this.isHost)return;const e=this.lobbies.get(this.currentLobbyId);if(!e)return;e.gameStarted=!0;const{countdownMs:t,startDelayMs:r}=this.getTimings();this.sendMessage({type:"game:starting",payload:{countdown:Math.round(t/1e3)}}),setTimeout(()=>{this.sendMessage({type:"game:started",payload:{lobby:e}}),setTimeout(()=>{this.sendNextQuestion(e)},r)},t)}handleSubmitAnswer(e){if(!this.currentLobbyId)return;const t=this.lobbies.get(this.currentLobbyId);if(!t)return;const{questionId:r,answer:o,timeSpent:i}=e,u=Math.random()>.3,c=u?Math.max(100,1e3-i*10):0,f=t.players.find(p=>p.id===this.playerId);f&&(f.score+=c),this.sendMessage({type:"answer:submitted",payload:{playerId:this.playerId,questionId:r,isCorrect:u,points:c}}),setTimeout(()=>{this.sendMessage({type:"scores:updated",payload:{scores:t.players.map(p=>({playerId:p.id,name:p.name,score:p.score}))}})},500)}handleSendMessage(e){const{text:t}=e;this.sendMessage({type:"message:received",payload:{id:Date.now().toString(),playerId:this.playerId,playerName:"You",text:t,timestamp:Date.now()}}),Math.random()>.7&&setTimeout(()=>{this.sendMessage({type:"message:received",payload:{id:Date.now().toString(),playerId:"other_player",playerName:"Other Player",text:this.getRandomChatMessage(),timestamp:Date.now()}})},Math.random()*2e3+1e3)}handlePlayerReady(){if(!this.currentLobbyId)return;const e=this.lobbies.get(this.currentLobbyId);if(!e)return;const t=e.players.find(r=>r.id===this.playerId);t&&(t.ready=!0),this.sendMessage({type:"player:ready",payload:{playerId:this.playerId}}),e.players.every(r=>r.ready)&&this.sendMessage({type:"lobby:updated",payload:{lobby:e,allReady:!0}})}sendNextQuestion(e){if(e.currentQuestion>=e.totalQuestions){this.endGame(e);return}e.currentQuestion++;const{questionTimeMs:t,betweenQuestionsMs:r}=this.getTimings(),o={id:`q_${e.currentQuestion}`,text:`Question ${e.currentQuestion}: What is the capital of France?`,options:["London","Paris","Berlin","Madrid"],correctAnswer:1,category:"Geography",difficulty:"easy",timeLimit:Math.round(t/1e3)};this.sendMessage({type:"question:start",payload:{question:o,questionNumber:e.currentQuestion,totalQuestions:e.totalQuestions}}),setTimeout(()=>{this.sendMessage({type:"question:end",payload:{questionId:o.id,correctAnswer:o.correctAnswer,explanation:"Paris is the capital of France."}}),setTimeout(()=>{this.sendNextQuestion(e)},r)},t)}endGame(e){const t=e.players.sort((r,o)=>o.score-r.score).map((r,o)=>({rank:o+1,playerId:r.id,name:r.name,score:r.score}));this.sendMessage({type:"game:ended",payload:{finalScores:t,winner:t[0]}}),e.gameStarted=!1,e.currentQuestion=0}sendMessage(e){const t=new MessageEvent("message",{data:JSON.stringify(e),origin:this.url});setTimeout(()=>{this.dispatchEvent(t)},0)}startSimulation(){this.simulationTimer=setInterval(()=>{if(this.readyState!==d.OPEN){this.stopSimulation();return}const e=Math.random();if(e<.1&&this.currentLobbyId){const t=this.lobbies.get(this.currentLobbyId);if(t&&t.players.length<t.maxPlayers&&!t.gameStarted){const r={id:`bot_${Date.now()}`,name:this.getRandomPlayerName(),score:0,ready:!1,connected:!0};t.players.push(r),this.sendMessage({type:"player:joined",payload:{player:r}})}}else e<.05&&this.sendMessage({type:"ping",timestamp:Date.now()})},5e3),this.scenario==="taskBoardLive"&&!this.taskTimer&&(this.taskTimer=setInterval(()=>{if(this.readyState!==d.OPEN)return;const e=["todo","in_progress","done","blocked"],t={id:`task_${Math.floor(Math.random()*1e4)}`,title:"Live update "+Math.floor(Math.random()*100),status:e[Math.floor(Math.random()*e.length)],updatedAt:new Date().toISOString()};this.sendMessage({type:"task:update",payload:t})},2e3))}getTimings(){return this.scenario==="matchHappyPath"?{countdownMs:1e3,questionTimeMs:5e3,betweenQuestionsMs:500,startDelayMs:300}:{countdownMs:3e3,questionTimeMs:3e4,betweenQuestionsMs:3e3,startDelayMs:1e3}}simulateTemporaryDisconnect(){this.didSimulateDisconnect||(this.didSimulateDisconnect=!0,setTimeout(()=>{this.readyState===d.OPEN&&(this.readyState=d.CLOSING,this.dispatchEvent(new CloseEvent("close",{code:1001,reason:"Simulated disconnect"})),this.stopSimulation(),setTimeout(()=>{this.readyState=d.OPEN,this.dispatchEvent(new Event("open")),this.startSimulation()},1500))},1e4))}stopSimulation(){this.simulationTimer&&(clearInterval(this.simulationTimer),this.simulationTimer=null),this.taskTimer&&(clearInterval(this.taskTimer),this.taskTimer=null)}getRandomPlayerName(){const e=["QuizMaster","BrainStorm","Genius","Scholar","Thinker","Challenger"];return e[Math.floor(Math.random()*e.length)]+Math.floor(Math.random()*100)}getRandomChatMessage(){const e=["Good luck everyone!","This is fun!","That was a tough one!","Great job!","I'm ready!","Let's go!","Nice score!","Almost had it!"];return e[Math.floor(Math.random()*e.length)]}get bufferedAmount(){return 0}get url_(){return this.url}get readyState_(){return this.readyState}get protocol_(){return this.protocol}get extensions_(){return this.extensions}get binaryType_(){return this.binaryType}set binaryType_(e){this.binaryType=e}};l(d,"CONNECTING",0),l(d,"OPEN",1),l(d,"CLOSING",2),l(d,"CLOSED",3);let b=d;function F(s,n){return new b(s,n)}function $(){typeof global<"u"&&(global.WebSocket=b,console.log("[MockWebSocket] WebSocket mocking enabled globally"))}A.USE_MOCK_WEBSOCKET==="true"&&$();function J(){const s=L.useRef(null),[n,e]=L.useState([]);return L.useEffect(()=>{const t=F("ws://mock");s.current=t;const r=o=>{try{const i=JSON.parse(o.data);(i==null?void 0:i.type)==="task:update"&&e(u=>[i.payload,...u].slice(0,20))}catch{}};return t.addEventListener("message",r),()=>{t.removeEventListener("message",r),t.close()}},[]),h.createElement("div",{style:{padding:16}},h.createElement("h3",null,"Live Task Board (WS mock)"),h.createElement("div",{style:{marginBottom:8}},h.createElement(W,null)),h.createElement("p",null,"Shows incoming task:update events from the WebSocket mock. Use the WS Scenario toolbar to switch scenarios; this story defaults to taskBoardLive."),h.createElement("ul",null,n.map((t,r)=>h.createElement("li",{key:r},h.createElement("code",null,t.id)," • ",h.createElement("strong",null,t.title)," • ",h.createElement("em",null,t.status)," •"," ",new Date(t.updatedAt).toLocaleTimeString()))),n.length===0&&h.createElement("div",null,"No updates yet…"))}const X={title:"Live/TaskBoard",component:J,parameters:{helpDoc:"/docs/mocks/WEBSOCKET_MOCKS.md",helpTitle:"WebSocket Mocks",helpDocs:[{href:"?path=/story/specs-service-catalog--page#websocket",title:"Service Catalog — WebSocket"}],docs:{description:{component:`A simple real-time task board feed driven by the WebSocket mock. Switch scenarios via the WS Scenario toolbar.
To simulate in the app, run with WS_MOCK_SCENARIO=taskBoardLive and EXPO_PUBLIC_USE_WS_MOCKS=1.`}},globals:{wsScenario:"taskBoardLive"}}},m={};var w,_,I;m.parameters={...m.parameters,docs:{...(w=m.parameters)==null?void 0:w.docs,source:{originalSource:"{}",...(I=(_=m.parameters)==null?void 0:_.docs)==null?void 0:I.source}}};const Z=["Default"];export{m as Default,Z as __namedExportsOrder,X as default};
