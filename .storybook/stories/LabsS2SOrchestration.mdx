# Labs: S2S Orchestration — Patterns and Exercises

import { Meta } from '@storybook/blocks';

<Meta title="Labs/S2S Orchestration" />

What this lab covers
- Service-to-service flows with contracts and mocks
- Exercising API shapes via MSW, API Playground, and Swagger
- Contract tests and migration to real services

Where to explore (stories)
- src/stories/s2s/S2SArchitecture.stories.tsx — diagrams and building blocks
- src/stories/s2s/S2SDashboard.stories.tsx — live controls for flows
- src/stories/Swagger.stories.tsx — OpenAPI-based exploration
- src/stories/ApiPlayground.stories.tsx — request builders with per-story MSW handlers

Docs to read
- .storybook/stories/SpecsServiceCatalog.mdx — endpoints, mocks, and flows
- .storybook/stories/SpecsDataEvents.mdx — analytics event taxonomy
- .storybook/stories/SpecsS2S.mdx — S2S concepts and patterns

Exercises
1) Define a minimal event contract
   - name, ts, sessionId/userId, payload
   - Validate in API Playground against MSW
2) Build an MSW handler for POST /api/analytics/event
   - Return 201 and echo key fields
   - Add error branches (400, 500) and verify UI behavior
3) Make a supertest contract
   - Given a valid event, expect 201 and saved record; else 400
   - Document shape in OpenAPI and verify Swagger story
4) Switch to real endpoint
   - Backed by Supabase insert; keep the MSW path for Storybook

Tips
- Keep request/response shapes versioned (v1) to avoid silent drift
- Prefer contract tests to detect schema breaks early
- Use MSW to simulate retries/latency/error profiles (see Latency Profiles lab)
