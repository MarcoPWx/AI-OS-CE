# Labs: Mobile Mock Beta — On-Device UI Iteration

import { Meta } from '@storybook/blocks';

<Meta title="Labs/Mobile Mock Beta" />

What this lab covers
- Run the app on iOS/Android using 100% mocks (no real backend)
- See the Demo/Mock banner overlay and verify console logs
- Understand how mock gating works in code and which env vars control it

Quickstart
1) Set env for mock mode
   - EXPO_PUBLIC_USE_ALL_MOCKS=1
   - EXPO_PUBLIC_MOCK_BANNER=1
2) Build/run on device or simulator (dev build)
   - iOS: run a dev build then install on simulator/device
   - Android: run a dev build then install on emulator/device
3) Smoke path (device)
   - Launch → Home → Category → Quiz → Results
   - Toggle network off (airplane mode) and repeat → should still work

How it works (code pointers)
- Banner overlay
  - src/components/MockBanner.tsx — visible when mock flags are on
  - AppWithAuth.tsx — renders <MockBanner /> if USE_MOCKS/EXPO_PUBLIC_USE_ALL_MOCKS/EXPO_PUBLIC_MOCK_BANNER is set
- Mock gating for Supabase
  - lib/supabase.ts (RN)
    - Uses mock client when EXPO_PUBLIC_USE_ALL_MOCKS=1 or USE_MOCKS=true
  - src/lib/supabase.ts (web/shared)
    - Prefers mock Supabase when USE_MOCKS=true or EXPO_PUBLIC_USE_ALL_MOCKS=1
- MSW (web only)
  - In App.tsx, MSW is started in web when EXPO_PUBLIC_USE_MSW=1 or EXPO_PUBLIC_USE_ALL_MOCKS=1

Acceptance criteria (Mobile Mock Beta)
- Build: EAS dev/preview builds install and run on-device with only mock services
- UX: Core quiz loop stable; visuals themed; mock banner visible
- Privacy: No secrets; no PII
- QA: Smoke path passes on iOS and Android
- Docs: DevLog/System Status updated

Troubleshooting
- If you see network errors, ensure mock flags are set and any real client init is guarded
- If banner doesn’t show, verify EXPO_PUBLIC_MOCK_BANNER=1 or USE_MOCKS=true
- If logs are missing, use a dev build and run in a debugger (Flipper/Xcode/Android Studio)
