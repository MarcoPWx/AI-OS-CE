# Labs: Sentry — Crash & Release Health (Expo/EAS)

import { Meta } from '@storybook/blocks';

<Meta title="Labs/Sentry — Crash & Release Health" />

Goal
- Capture JS/native crashes and release health in iOS/Android builds with minimal friction. Keep it off by default; enable via env when needed.

Two approaches
1) sentry-expo (recommended for Expo/EAS)
- Pros: Auto source-map upload and symbolication in EAS builds
- Steps (overview):
  - Install: expo install sentry-expo
  - Config: add plugin to app.json/app.config.js
    - plugins: ["sentry-expo"]
  - Init in app entry and gate via env:
    ```ts path=null start=null
    import * as Sentry from 'sentry-expo';

    if (process.env.EXPO_PUBLIC_ENABLE_SENTRY === '1' && process.env.SENTRY_DSN) {
      Sentry.init({
        dsn: process.env.SENTRY_DSN,
        enableInExpoDevelopment: true,
        debug: false,
        tracesSampleRate: 0.1,
      });
    }
    ```
  - Build with EAS; source maps upload automatically

2) @sentry/react-native (already present)
- Pros: No extra dependency
- Cons: Manual source-map and native symbol uploads in EAS builds
- Steps (overview):
  - Init in app entry (gate via env):
    ```ts path=null start=null
    import * as Sentry from '@sentry/react-native';

    if (process.env.EXPO_PUBLIC_ENABLE_SENTRY === '1' && process.env.SENTRY_DSN) {
      Sentry.init({
        dsn: process.env.SENTRY_DSN,
        enableAutoSessionTracking: true,
        tracesSampleRate: 0.1,
      });
    }
    ```
  - Configure CLI to upload JS source maps and native symbols during EAS builds

Env and secrets
- Do not print SENTRY_DSN. Set SENTRY_DSN and EXPO_PUBLIC_ENABLE_SENTRY=1 in the build environment when you want crash capture.
- Keep it off (default) for mock UI iteration builds.

Validation steps
- Trigger a test exception in a sandbox screen when EXPO_PUBLIC_ENABLE_SENTRY=1
- Confirm event appears in Sentry with readable stack
- Verify release health tracks crash-free users (optional)

Interview talk track
- Explain the gating: crashes on when needed, off for pure UI sessions
- sentry-expo vs @sentry/react-native tradeoffs
- Show how symbolication/source maps work so stacks are readable

